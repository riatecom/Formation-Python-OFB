---
title: "Formation Python pour g√©omaticiens üêçüåè"
author: "Matthieu Viry"
subtitle: "11 D√©cembre 2023"
format:
  revealjs:
    embed-resources: false
    slide-number: true
    show-slide-number: all
    chalkboard: true
    logo: images/logos-footer.png
jupyter: python3
title-slide-attributes:
  data-background-image: images/logos-footer.png
  data-background-size: 42%
  data-background-position: 50% 90%
css: ['static/style.css']
prefer-html: true
bibliography: references.bib
csl: "universite-de-montreal-apa.csl"
lang: fr
---

# Partie 1 - Introduction √† Python

## Pourquoi programmer ?

- **Automatiser** des t√¢ches r√©p√©titives
- **Prendre le contr√¥le** des analyses et des traitements que vous r√©alisez

## Historique et pr√©sentation sur le papier...

<img src="images/logo-python.png" style="position: absolute;top: 10px;right: 10px;width: 105px !important;height: auto;" />

<br>

- Langage cr√©√© √† la toute fin des ann√©es 80 - premi√®re version publique sortie en 1991.

- **Libre** (r√©git par la *Python Software Foundation License*, √©quivalent √† BSD)

- Langage **polyvalent**, **interpr√©t√©**, **multi-paradigme** (imp√©ratif, fonctionnel, OO, ..)

- **Typage dynamique fort** (et *duck typing*)

- Toujours en d√©veloppement actif (derni√®re version en avril 2023)

::: {.notes}


En 1989 aux Pays-Bas, Guido van Rossum invente le langage de programmation Python.
C‚Äôest un fan de la s√©rie t√©l√©vis√©e Monty Python‚Äôs Flying Circus, donc pour rendre un hommage √† la s√©rie il donne le nom Python.
Ce n‚Äôest qu‚Äôen 1991 que la premi√®re version de ce langage a √©t√© publi√©e.

C‚Äôest la Python Software Foundation qui se charge de d√©velopper Python et de faire vivre la communaut√© de d√©veloppeurs et utilisateurs.


- Il est multiplateforme : fonctionne sur des nombreux syst√®mes d‚Äôexploitation ;
- C'est un logiciel libre
- C‚Äôest un langage interpr√©t√© : le script python est directement ex√©cut√©, il n‚Äôa pas besoin d‚Äô√™tre compil√© avant d‚Äô√™tre ex√©cut√© ;
- C‚Äôest un langage orient√© objet : on peut cr√©er des programmes qui imite le comportement du monde r√©el ;
- Enfin, il est notamment utilis√© en bio-informatique, et plus couramment en analyse de donn√©es.


Sur le site web, la description en une phrase du projet est "Python is a programming language that lets you work quickly and integrate systems more effectively"

Pour sa part le projet **R** na√Æt en 1993 comme un projet de recherche de Ross Ihaka et Robert Gentleman √† l'universit√© d'Auckland.

- C'est une impl√©mentation du langage **S** (d√©velopp√© au milieu des ann√©es 70 dans les laboratoires Bell)

- **Libre** (licence *GNU GPL*)

- Langage **interpr√©t√©**, **multi-paradigme** (imp√©ratif, fonctionnel, OO, ..)

- **Typage dynamique**

- Toujours en d√©veloppement actif (derni√®re version en avril 2023)


Sur le site web, le titre est "The R Project for Statistical Computing" et la description en une phrase du projet est : "R is a free software environment for statistical computing and graphics".

:::

## Python

:::{.center}

![](images/xkcd-python.png)

:::
   
## Python / R

<br>

:::: {.columns}

::: {.column .medium width="50%"}

### Python

- *General-purpose programming language*

- *"Jack of all trades, master of none"* ?

- Utilis√© par Google, Facebook, Spotify, IBM, etc.

:::

::: {.column .medium width="50%"}


### R

- *For statistical computing and graphics*

- *"By statisticians, for statisticians"*

- Utilis√© par Google, Facebook, Microsoft, etc.

:::

::::

- Mais la question se pose car Python est de plus en plus comp√©tent pour l'analyse de donn√©es...

# Pr√©sentation de l'√©cosyst√®me

## Impl√©mentation de r√©f√©rence et distributions

- Une impl√©mentation de r√©f√©rence du langage [**Python**](https://www.python.org/) : [**CPython**](https://github.com/python/cpython)
  (mais d'autres impl√©mentations : Jython, IronPython, PyPy, etc.)

- Plusieurs *distributions* de Python (principalement [**Anaconda**](https://anaconda.org/), une distribution des langages de programmation Python et R d√©di√©e √† la science des donn√©es et √† l'apprentissage automatique)

<div class="center">
<img src="images/logo-anaconda.png" />
<p class="small">Source: <a href="https://anaconda.org">anaconda.org</a></p>
</div>

::: {.notes}

- CPython est l'impl√©mentation de r√©f√©rence de Python. C'est la version que la plupart des gens utilisent, notamment parce qu'elle est la plus facile √† installer et √† utiliser. Il est √©crit en langage C et est maintenu par la Python Software Foundation.

- Jython est une impl√©mentation de Python √©crite en Java. Il permet aux d√©veloppeurs d'√©crire des programmes Python qui peuvent √™tre ex√©cut√©s sur n'importe quelle machine virtuelle Java (JVM). Cela le rend particuli√®rement utile pour les d√©veloppeurs qui travaillent dans un environnement Java.

- IronPython est une impl√©mentation de Python √©crite en C# et destin√©e √† √™tre utilis√©e dans l'environnement .NET. Il permet aux d√©veloppeurs d'√©crire des programmes Python qui peuvent √™tre ex√©cut√©s sur la plate-forme .NET. Il est particuli√®rement utile pour les d√©veloppeurs qui travaillent dans un environnement .NET.

- PyPy est une impl√©mentation alternative de Python qui est destin√©e √† √™tre plus rapide que CPython. Il est √©crit en langage RPython et utilise une technique d'optimisation appel√©e compilation √† la vol√©e pour acc√©l√©rer l'ex√©cution des programmes.


Anaconda est une distribution gratuite et open source de Python et R, qui a √©t√© d√©velopp√©e pour simplifier le processus
d'installation et de gestion des packages, ainsi que le processus
de configuration et de gestion des environnements de d√©veloppement scientifique de donn√©es.

Il a √©t√© cr√©√© par Continuum Analytics, une entreprise qui a depuis √©t√© acquise par Anaconda, Inc.

Anaconda est livr√© avec une gamme compl√®te de biblioth√®ques scientifiques et de packages pr√©install√©s,
tels que NumPy, pandas, Matplotlib, SciPy, scikit-learn, TensorFlow et Jupyter Notebook, pour n'en citer que quelques-uns.
Il est √©galement facile √† √©tendre avec des packages tiers, en utilisant le gestionnaire de packages conda, qui permet de t√©l√©charger et d'installer des packages √† partir de sources externes.

L'un des avantages les plus importants d'Anaconda est son syst√®me de gestion d'environnement,
qui permet de cr√©er des environnements Python isol√©s pour diff√©rents projets.

:::

## Environnements de d√©veloppement

- Plusieurs IDE appr√©ci√©s par les utilisateurs de Python : [**Spyder**](https://www.spyder-ide.org/) (IDE "scientifique", interface comparable √† RStudio),
  [**PyCharm**](https://www.jetbrains.com/pycharm/) (logiciel propri√©taire, plut√¥t pour d√©velopper des biblioth√®ques), [**Jupyter Lab**](https://jupyter.org/)
  et plus r√©cemment [**Visual Studio Code**](https://code.visualstudio.com/).


<img src="images/spyder.png" style="float:left; width: 46%;" />

<img src="https://www.jetbrains.com/pycharm/img/screenshots/complexLook@2x.jpg" style="float:right; width: 46%;"/>

## Packages additionnels (biblioth√®ques)


## Documentation / Python

::: {.medium}
Un point fort de Python est sa documentation officielle, qui contient tout le n√©cessaire pour utiliser le langage de mani√®re proactive
(tutoriel, r√©f√©rence de l'ensemble des fonctions / objets de tous les modules de la biblioth√®que standard, etc.)
et qui est mise √† disposition dans plusieurs langues (Anglais, Fran√ßais, Espagnol, Cor√©en, Japonais, Chinois, etc.).
:::

![](images/python-documentation.png)


## Documentation / Python


Il n'existe toutefois pas un seul standard pour consulter la documentation des diff√©rents modules additionnels Python
(cf. [Documentation Matplotlib](https://matplotlib.org/stable/api/index), [Documentation pandas](https://pandas.pydata.org/docs/reference/index.html#api)).

<img src="images/doc-geopandas.png" style="width: 40%; position: absolute; border: solid 1px black; left: 10px;" />

<img src="images/doc-matplotlib.png" style="width: 40%; position: absolute; border: solid 1px black; bottom: -60px; left: 29%;" />

<img src="images/doc-samgeo.png" style="width: 40%; position: absolute; border: solid 1px black; right: 10px;" />

# En terme de syntaxe √ßa donne quoi ?

## Premier pas avec la syntaxe Python

<br><br>

```{python}
#| error: true
#| echo: true
#| message: true
#| cache: true
from statistics import mean, stdev

def cv(x):
    moy = mean(x)
    s = stdev(x)
    result = s / moy
    return result

print(cv([5, 6, 3, 8, 9, 12]))
```

## Python et l'indentation du code...

<br>

```{python}
#| error: true
#| echo: true
#| message: true
#| cache: true
my_list = [1, 2, 3]

for item in my_list:
    if item % 2 == 0:
        print('even')
    else:
    print('odd')
```

## Python et l'indentation du code...

<br>

```{python}
#| error: true
#| echo: true
#| message: true
#| cache: true
my_list = [1, 2, 3]

for item in my_list:
    if item % 2 == 0:
        print('even')
    else:
        print('odd')
```

## Python et l'indentation du code...

<br>

- Respecter les r√®gles d‚Äôindentations est *obligatoire* en Python.

- Ce n'est pas une *contrainte* lors d'une session de travail car les IDE guident la position du curseur.

- Cette indentation a un r√¥le direct sur le contr√¥le du flux d'ex√©cution.

- Elle permet notamment d'√©viter l'utilisation d'accolades (*curly brackets*) pour d√©limiter les blocs et de point-virgules pour d√©limiter les instructions.


## Python et l'indentation du code...

<br>

Le code qui suit est volontairement incorrect mais ne g√©n√®re pas d'erreur lors de l'ex√©cution :

```{python}
#| echo: true
li1 = [1, 2, 3, 4, 5, 6]
li2 = [4, 20, 31, 87, 123, 621]

# Additionnons les deux listes, √©l√©ments par √©l√©ments,
# et stockons chaque r√©sultat dans une nouvelle liste
result = []

for item1, item2 in zip(li1, li2):
    new_item = item1 + item2
result.append(new_item)

print(result)
```

## Python et l'indentation du code...

<br>

Une fois l'indentation corrig√©e...

```{python}
#| echo: true
li1 = [1, 2, 3, 4, 5, 6]
li2 = [4, 20, 31, 87, 123, 621]

# Additionnons les deux listes, √©l√©ments par √©l√©ments,
# et stockons chaque r√©sultat dans une nouvelle liste
result = []

for item1, item2 in zip(li1, li2):
    new_item = item1 + item2
    result.append(new_item)

print(result)
```


# *Data structures* natives

:::{.small}
*Les structures de donn√©es sont les √©l√©ments fondamentaux autour desquels vous construisez vos programmes. Chaque structure de donn√©es fournit une mani√®re particuli√®re d'organiser les donn√©es afin d'y acc√©der efficacement.*
:::

## Python

<br>

:::{.medium}

Python est livr√© avec un ensemble complet de structures de donn√©es dans sa biblioth√®que standard :

- `dict` (tableau associatif)

```{python}
#| echo: true
my_dict = { 'john': 32, 'jane': 27, 'jack': 30 }
print(my_dict['john'])
```

- `tuple` (un conteneur immuable),

```{python}
#| echo: true
my_coordinates = (2.349014, 48.864716)
```

- `list` (tableau dynamique mutable),

```{python}
#| echo: true
my_list = ['a', 12, (2.349014, 48.864716), { "foo": 42 }]
```

- `array` (tableau typ√© de base), `enum` (√©num√©ration), etc.

:::

## Python *(classes)*

<br>

Comme il s'agit d'un langage orient√©-objet, il est √©galement possible de d√©finir des classes, permettant de facilement mod√©liser des cat√©gories d'objets...

```{python}
#| echo: true
class Point:
    def __init__(self, x, y):
      self.x = x
      self.y = y

    def distance(self, other):
      return (
        (other.x - self.x) ** 2 + (other.y - self.y) ** 2
      ) ** 0.5
```

## Python *(classes)*

<br>
<br>

Instanciation et utilisation :

```{python}
#| echo: true
p1 = Point(2, 6)
p2 = Point(9, 9)

print('Distance = ', p1.distance(p2))
```

# Et c√¥t√© s√©mantique ?

## Python

S√©mantique *pass-by-assignment* et diff√©rence entre types muables et immuables :

```{python}
#| echo: true
# le type list est muable
a = [1, 3, 5]
b = a # 'a' et 'b' pointent vers le m√™me objet

b[2] = 11 # Modifie l'objet vers lequel pointe 'b' qui est √©galement celui vers lequel pointe 'a'
```

```{python}
#| echo: true
i = 5 # les entiers sont immuables
j = i
i = i + 1 # la valeur 5 ne peut pas √™tre modifi√©e, un nouvel objet est cr√©√© ici

print(i) # 6
print(j) # 5
```

:::{.medium}
Pour en savoir plus sur ce point : [Documentation officielle -  Questions fr√©quemment pos√©es sur Python](https://docs.python.org/fr/3/faq/programming.html#why-did-changing-list-y-also-change-list-x)
:::

:::{.notes}

Les instructions d'affectation en Python ne copient pas les objets, elles cr√©ent des liens entre une cible et un objet.
Pour les collections qui sont mutables ou qui contiennent des √©l√©ments mutables, une copie est parfois n√©cessaire afin de pouvoir modifier une copie sans modifier l'autre.

Copie superficielle (*Shallow copy*) vs. profonde (*deep copy*).

:::

## Indices

<br>

- En Python les indices de liste commencent √† 0 :

```{python}
#| echo: true
my_list = [1, 3, 5]
print(my_list[0])
```

## Maintenabilit√© du code

<br>

```{python}
#| echo: true
class Point:
    def __init__(self, x, y):
      self.x = x
      self.y = y

    def distance(self, other):
      return (
        (other.x - self.x) ** 2 + (other.y - self.y) ** 2
      ) ** 0.5
```

## Maintenabilit√© du code

<br>

```{python}
#| echo: true
class Point:
    def __init__(self, x: float, y: float) -> None:
      self.x = x
      self.y = y

    def distance(self, other: Point) -> float:
      return (
        (other.x - self.x) ** 2 + (other.y - self.y) ** 2
      ) ** 0.5
```

- [_**Type hint**_](https://docs.python.org/fr/3/library/typing.html) ...
- \+ analyse statique du code ([*mypy*](https://www.mypy-lang.org/), IDE, etc.)

# Mise en place d'un environnement de travail Python

## Installation de Python

:::{.very-small}

1. T√©l√©charger et installer [Anaconda](https://www.anaconda.com/products/individual) :
   - Une fois le fichier t√©l√©charg√©, double-cliquez dessus
   - Accepter les termes de la licence
   - Choisir d'installer Anaconda seulement pour l'utilisateur courant (*Just me*) et non pas pour tous les utilisateurs (*All users*)
   - S√©lectionner le chemin d'installation (ou laisser celui par d√©faut - attention √† √©viter les chemins avec des espaces et/ou des caract√®res unicodes)
   - Accepter ensuite les options par d√©faut jusqu'√† la fin de l'installation (sur la derni√®re fen√™tre "Thanks for installing Anaconda", vous pouvez d√©cocher les deux cases et cliquer sur "Finish")
2. T√©l√©charger l'IDE [VS Codium](https://vscodium.com/) (version libre de [Visual Studio Code](https://code.visualstudio.com/)) pour votre syst√®me d'exploitation :
   - Vous pouvez utilisez le lien direct suivant : https://github.com/VSCodium/vscodium/releases/download/1.84.2.23319/VSCodiumUserSetup-x64-1.84.2.23319.exe
   - Cliquer sur l'installeur et suivez les instructions en laissant les options par d√©faut
   - Une fois l'installation termin√©e, ouvrez VS Codium
3. Installer l'extension [Python](https://marketplace.visualstudio.com/items?itemName=ms-python.python) dans VS Codium :
   - Dans VS Codium, appuyez sur Ctrl + P et saisissez le texte suivant dans le menu qui s'ouvre : "ext install ms-python.python".
   - Validez avec "Entr√©e"
4. Installer l'extension [Jupyter](https://marketplace.visualstudio.com/items?itemName=ms-toolsai.jupyter) dans VS Codium :
   - Dans VS Codium, appuyez sur Ctrl + P et saisissez le texte suivant dans le menu qui s'ouvre : "ext install ms-toolsai.jupyter".
   - Validez avec "Entr√©e"
5. S√©lectionner l'interpr√©teur Python dans VS Codium :
   - Dans VS Codium, appuyez sur Ctrl + Shift + P et saisissez / s√©lectionnez "Python: Select Interpreter" dans le menu qui s'ouvre, appuyez sur "Entr√©e" puis choisissez l'interpr√©teur Python que nous venons d'installer avec Anaconda : `Python 3.11.5 64-bit ('base': conda)`.

:::



# √âcosyst√®me pour le g√©ospatial

## Donn√©es vectorielles

::::{.small}

-   [**Bindings Python de GDAL/OGR**](https://gdal.org/api/python_bindings.html) [@GDAL]
-   [**Fiona**](https://fiona.readthedocs.io/en/stable/) [@fiona] - I/O (*wrapper* de haut niveau autour d'OGR)
-   [**Shapely**](https://shapely.readthedocs.io/)  [@sgillies_2023] - bindings Python de [GEOS](https://github.com/libgeos/geos) [@GEOS]
-   [**Pyproj**](https://pyproj4.github.io/pyproj) [@pyproj] - bindings Python de [PROJ](https://proj.org/) [@PROJ]
-   [**Geopandas**](https://geopandas.org/)  [@kelsey_jordahl_2020_3946761] - √âtend les `DataFrame`s de [pandas](https://pandas.pydata.org/) [@pandas]

::::

::::{.columns}
:::{.column width="50%"}

![](./images/logo-pandas.svg){width=300}

:::

:::{.column width="50%"}

![](./images/logo_geopandas.svg){width=340}

:::
::::

## Le package *GeoPandas*

:::{.medium}

Un projet open source pour faciliter le travail avec des donn√©es g√©ospatiales vectorielles en Python. GeoPandas √©tend Pandas pour permettre de disposer d'un type de colonne g√©om√©trique et pour permettre d'effectuer des op√©rations spatiales. Les op√©rations g√©om√©triques sont r√©alis√©es avec `shapely`, les acc√®s en lecture / √©criture aux fichiers utilisent `fiona` et la visualisation utilise `matplotlib`.

![Format des GeoDataFrame](./images/geopandas-table.png)

:::

## Le package *GeoPandas* - Exemples

::: {.panel-tabset .custom-tab .small}

### Import et lecture

```{python gpd-tuto-import-1}
#| echo: false
import geodatasets

file_path = geodatasets.get_path("nybb")
```

Avec la fonction `read_file` :

```{python gpd-tuto-import-2}
#| echo: true
import geopandas as gpd

nybb = gpd.read_file(file_path)
```

### Affichage

Avec la m√©thode `plot` des `GeoDataFrame` :

```{python gpd-tuto-plot}
#| echo: true
nybb.plot()
```

### SCR

Affichage :

```{python gpd-tuto-crs}
#| echo: true
print(nybb.crs)
```

Transformation :

```{python gpd-tuto-transformation}
#| echo: true
nybb_geo = nybb.to_crs('EPSG:4326')
```

### Affichage avec fond de carte

En utilisant la biblioth√®que `contextily` :

```{python gpd-tuto-contextily}
#| echo: true
import contextily as cx

ax = nybb.to_crs('EPSG:3857').plot()
cx.add_basemap(ax, source='https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png')
ax.set_axis_off()
ax
```

### Centroide

Simplement en utilisant l'attribut `centroid` des `GeoDataFrame` :

```{python gpd-tuto-centroid}
#| echo: true
nybb.centroid.plot()
```

### Boundary

Simplement en utilisant l'attribut `boundary` des `GeoDataFrame` :

```{python gpd-tuto-boundary}
#| echo: true
nybb.boundary.plot()
```

### Zone tampon

En utilisant la m√©thode `buffer` des `GeoDataFrame` :

```{python gpd-tuto-buffer}
#| echo: true
buff_nybb = nybb.buffer(3000)
```

```{python gpd-tuto-buffer-2}
#| echo: true
ax = buff_nybb.plot(color="red")
nybb.plot(ax=ax, color="aliceblue")
```


### Aggr√©gation

En utilisant la m√©thode `dissolve` des `GeoDataFrame` :

```{python gpd-tuto-agg}
#| echo: true
# On peut utiliser dissolve(by="nom_colonne") si on veut aggr√©ger selon les valeurs d'une colonne
agg = nybb.dissolve()
agg.plot()
```


### Intersection

En utilisant la m√©thode `intersection` des `GeoDataFrame` :

```{python gpd-tuto-intersection}
#| echo: true
from shapely import wkt

point = wkt.loads('Point(998769.1146889535 174169.7607268664)')

intersecting = nybb.intersection(point.buffer(35000))
```

<br>

```{python gpd-tuto-intersectiob-2}
#| echo: true
ax = nybb.plot()
ax = intersecting.plot(ax=ax, color="red")
ax
```

:::


## Donn√©es raster

::::{.columns .medium}

:::{.column width="50%"}

[**Rasterio**](https://rasterio.readthedocs.io/) [@gillies_2019] :

:::{.small}

* lecture / √©criture de raster (*wrapper* de haut niveau autour de GDAL)
* donn√©es repr√©sent√©es sous forme d'`array` NumPy
* reprojection
* _resampling_
* _virtual files_
* etc.

:::

:::

:::{.column width="50%"}

[**Rasterstats**](https://pythonhosted.org/rasterstats/) :

:::{.small}

* r√©sumer des donn√©es raster sur la base de g√©om√©tries vectorielles
* extraction de valeurs √† un point pr√©cis

:::

[**xarray**](https://docs.xarray.dev/en/stable/) [@xarray] et [**rioxarray**](https://corteva.github.io/rioxarray/) [@rioxarray]:

:::{.small}

* *xarray* pour travailler avec des tableaux multidimensionnels √©tiquet√©s
* *rioxarray* pour ouvrir des jeux des donn√©es raster avec *rasterio*, les stocker dans le format de *xarray*, et avoir acc√®s √† diff√©rentes fonctionnalit√©s de *rasterio*
* moins "rustique" que d'utiliser rasterio seul / d√©pend de l'usage souhait√©

:::

:::
::::

## Le package *Rasterio*

:::{.small}

Exemple d'utilisation :

```{python example-rio-1}
#| echo: true
import rasterio as rio

with rio.open('./data/MODIS_ARRAY.nc') as f:
    # M√©tadonn√©es :
    metadata = f.meta
    # Lire toutes les bandes :
    data = f.read()
    # Ou f.read(1) pour lire seulement la premi√®re bande
```

- Un dictionnaire de m√©tadonn√©es + un tableau NumPy contenant la (ou les) bande(s) :

```{python example-rio-2}
#| echo: true
print(metadata)
print(data)
```

:::

## Les package *xarray* et *rioxarray*

Exemple d'utilisation :

::: {.panel-tabset .custom-tab}

### Import et lecture

```{python xarray-tuto-import-1}
#| echo: true
import rioxarray
import xarray

xds = xarray.open_dataarray("./data/MODIS_ARRAY.nc")
```

- Un objet de type `xarray.DataArray` ou `xarray.Dataset` qui contient les diff√©rentes m√©ta-donn√©es et les donn√©es :

```{python xarray-tuto-import-2}
xds
```

### Compl√©tion des valeurs manquantes

```{python xarray-tuto-na}
#| echo: true
filled = xds.rio.interpolate_na()
```

### Affichage

En utilisant la m√©thode `plot` des objets `xarray.DataArray` (ici apr√®s s√©lection d'un *subset* des donn√©es) :

```{python xarray-tuto-plot}
#| echo: true
import matplotlib.pyplot as plt

fig = plt.figure(figsize=(15, 5))
ax1, ax2 = (fig.add_subplot(131), fig.add_subplot(133))

xds.isel(x=slice(0, 20), y=slice(0, 20)).plot(ax=ax1)
filled.isel(x=slice(0, 20), y=slice(0, 20)).plot(ax=ax2)
```

### SCR

- Affichage :

```{python xarray-tuto-crs-1}
#| echo: true
xds.rio.crs
```

- Transformation :

```{python xarray-tuto-crs-2}
#| echo: true
xds = xds.rio.reproject("EPSG:6623")
```

### D√©coupage

- D√©coupage selon l'emprise des donn√©es contenues dans un `GeoDataFrame` (ici `gdf`) :

```{python xarray-tuto-clipping}
#| echo: true
#| eval: false
clipped = xds.rio.clip(gdf.geometry.values, gdf.crs, drop=False, invert=True)
```

:::


## Analyse spatiale

<img src="./images/logo-pysal.png" style="position: absolute; top: 20px; right: 20px; width: 90px; height: auto;"/>

<br />

:::{.medium}

√âcosyst√®me de biblioth√®ques pour l'analyse spatiale [PySAL](https://pysal.org/) (Python Spatial Analysis Library, @pysal2007) :

:::

:::: {.columns .small}

::: {.column width="50%"}

**Explorer**:

- Analyse exploratoire des donn√©es spatiales (package [esda](https://pysal.org/esda/))
- Analyse de la dynamique des donn√©es spatiales longitudinales (package [giddy](https://pysal.org/giddy/))
- Mesure des in√©galit√©s dans l'espace et dans le temps (package [inequality](https://inequality.readthedocs.io/en/latest/))
- Analyse statistique de motifs ponctuels planaires (package [pointpats](https://pysal.org/pointpats/))
- Mesure de la s√©gr√©gation dans le temps et dans l'espace (package [segregation](https://pysal.org/segregation/))
- Morphom√©trie urbaine (package [momepy](https://docs.momepy.org/en/stable/))

:::

::: {.column width="50%"}

**Mod√©liser**:

- R√©gression g√©ographiquement pond√©r√©e √† plusieurs √©chelles (package [mgwr](https://mgwr.readthedocs.io/en/latest/))
- Mod√®les lin√©aires g√©n√©ralis√©s √©pars (package [spglm](https://spglm.readthedocs.io/en/latest/))
- Mod√®les d'interaction spatiale (package [spint](https://spint.readthedocs.io/en/latest/))
- Mod√®les de r√©gression spatiale (package [spreg](https://spreg.readthedocs.io/en/latest/))
- Mod√®les de composantes de variance √† corr√©lation spatiale √† plusieurs niveaux (package [spvcm](https://github.com/pysal/spvcm))
- *Areal interpolation* et cartographie dasym√©trique (package [tobler](https://pysal.org/tobler/))
- Accessibilit√© spatiale (package [access](https://pysal.org/access/))
- Optimisation spatiale (package [spopt](https://pysal.org/spopt/))

:::

::::


## Autres packages utiles ...

- Binding Python pour [GRASS](https://grass.osgeo.org/grass82/manuals/libpython/index.html) + Int√©gration dans les notebooks Jupyter

![Source: <https://grass.osgeo.org/news/2022_06_05_results_student_grant_caitlin/>](./images/grass_jupyter_combo_vis.png)

- [Iris](https://scitools-iris.readthedocs.io/en/stable/) - Analyse et visualisation de donn√©es des sciences de la Terre.

- Pour la cartographie : [cartopy](https://scitools.org.uk/cartopy/docs/latest/) ; [geoviews](https://geoviews.org/) et [geoplot](https://residentmario.github.io/geoplot/) bas√©s sur *cartopy* ; [PyGMT](https://www.pygmt.org/latest/) (selon les usages - pas de solution aussi aboutie que `mapsf` pour les cartes r√©alis√©es en SHS).

![](./images/cartopy.png)

- Un √©cosyst√®me riche pour le g√©ospatial (voir par exemple ici : [https://github.com/sacridini/Awesome-Geospatial#python](https://github.com/sacridini/Awesome-Geospatial#python)) et la visualisation de donn√©es (voir par exemple les outils list√©s par la plateforme [PyViz](https://pyviz.org/tools.html)).

## Ressources Python G√©ospatial

- [https://py.geocompx.org/](https://py.geocompx.org/) [@Dorman2022]

- [https://geo-python-site.readthedocs.io/en/latest/](https://geo-python-site.readthedocs.io/en/latest/)

- [https://automating-gis-processes.github.io](https://automating-gis-processes.github.io)

- [https://www.earthdatascience.org/courses/use-data-open-source-python/](https://www.earthdatascience.org/courses/use-data-open-source-python/)

- [https://geographicdata.science/book/intro.html](https://geographicdata.science/book/intro.html)

# Partie 2 - Python et QGIS

## R√©f√©rences

<!-- R√©f√©rence will be added here automatically from 'references.bib' -->



